<!DOCTYPE html>
<html>
<head>
    <title>最快视频流播放器</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/artplayer@5.1.6/dist/artplayer.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        
        #video-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .artplayer-app {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
            z-index: 100;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            font-size: 16px;
            text-align: center;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <div class="loading">正在加载最快线路...</div>
        <div class="artplayer-app" id="artplayer-app"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/artplayer@5.1.6/dist/artplayer.js"></script>
<script>
/* ========== 配置 ========== */
const apiArray = [
  {name:'线路1', url:'https://www.ckplayer.vip/jiexi/?url='},
  {name:'线路2', url:'https://jx.m3u8.tv/jiexi/?url='}
];

/* ========== 取目标视频地址 ========== */
const origin = decodeURIComponent((location.href.match(/url=([^&]+)/)||[])[1]);
if(!origin){showError('缺少url参数'); throw new Error('缺少url参数');}

/* ========== DOM ========== */
const loadingEl = document.querySelector('.loading');
let art = null;

/* ========== 工具 ========== */
function showError(msg){
  loadingEl.style.display='none';
  document.getElementById('video-container').insertAdjacentHTML('beforeend',
    `<div class="error">${msg}<br><small>示例：?url=https://example.com/video.mp4</small></div>`);
}

/* ========== 真实测速：用 link prefetch ========== */
function testByPrefetch(api){
  return new Promise(resolve=>{
    const link = document.createElement('link');
    link.rel = 'prefetch';
    link.href = api.url + encodeURIComponent(origin);
    const start = performance.now();
    link.onload = () => resolve({api, time:performance.now()-start, ok:true});
    link.onerror = () => resolve({api, time:Infinity, ok:false});
    document.head.appendChild(link);
    setTimeout(()=>link.remove(), 100);   // 清理
  });
}

/* ========== 选最快 ========== */
async function pickFastest(){
  const res = await Promise.all(apiArray.map(testByPrefetch));
  const fast = res.filter(r=>r.ok).sort((a,b)=>a.time-b.time)[0];
  if(!fast){showError('所有线路都无法连接'); return;}
  console.log(`最快线路：${fast.api.name}  ${fast.time.toFixed(0)}ms`);
  play(fast.api.url + encodeURIComponent(origin), fast.api.name);
}

/* ========== ArtPlayer ========== */
function play(src, name){
  loadingEl.style.display='none';
  art = new Artplayer({
    container: '#artplayer-app',
    url: src,
    title: `正在播放 - ${name}`,
    autoplay: true,
    muted: false,
    fullscreen: true,
    fullscreenWeb: true,
    pip: true,
    screenshot: true,
    mutex: true
  });
  art.on('error', ()=>showError('播放失败，请刷新重试'));
}

/* ========== 启动 ========== */
document.addEventListener('DOMContentLoaded', pickFastest);
</script>
</body>
</html>



