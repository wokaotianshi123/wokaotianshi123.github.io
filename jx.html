<!DOCTYPE html>
<html>
<head>
    <title>最快视频流播放器</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/artplayer@5.1.6/dist/artplayer.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }
        
        #video-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .artplayer-app {
            width: 100%;
            height: 100%;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 18px;
            z-index: 100;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff6b6b;
            font-size: 16px;
            text-align: center;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <div class="loading">正在加载最快线路...</div>
        <div class="artplayer-app" id="artplayer-app"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/artplayer@5.1.6/dist/artplayer.js"></script>
<script>
    var apiArray = [
        { name: "线路1", url: "https://www.ckplayer.vip/jiexi/?url=" },
        { name: "线路2", url: "https://jx.m3u8.tv/jiexi/?url=" }
    ];

    var origin = decodeURIComponent((document.location.href.match(/url=([^&]+)/) || [])[1]);
    if (!origin || origin === "undefined") {
        showError("未提供视频URL参数");
        return;
    }

    var loadingEl = document.querySelector(".loading");
    var art = null;

    function showError(msg) {
        loadingEl.style.display = "none";
        var div = document.createElement("div");
        div.className = "error";
        div.innerHTML = msg;
        document.getElementById("video-container").appendChild(div);
    }

    async function testSpeed(api) {
        const start = performance.now();
        try {
            const res = await fetch(api.url + encodeURIComponent(origin), { method: "HEAD", mode: "no-cors" });
            // no-cors 模式下无法读取状态，但会完成网络握手
            return { api, time: performance.now() - start, ok: true };
        } catch {
            return { api, time: Infinity, ok: false };
        }
    }

    async function pickFastest() {
        const results = await Promise.all(apiArray.map(testSpeed));
        const fastest = results.filter(r => r.ok).sort((a, b) => a.time - b.time)[0];
        if (!fastest) {
            showError("所有线路都无法连接");
            return;
        }
        console.log("最快线路:", fastest.api.name, fastest.time.toFixed(0) + "ms");
        playWithArtPlayer(fastest.api.url + encodeURIComponent(origin), fastest.api.name);
    }

    function playWithArtPlayer(src, name) {
        loadingEl.style.display = "none";
        art = new Artplayer({
            container: "#artplayer-app",
            url: src,
            title: "视频播放 - " + name,
            autoplay: true,
            muted: false,
            fullscreen: true,
            fullscreenWeb: true,
            pip: true,
            screenshot: true,
            playbackRate: true,
            setting: true,
            hotkey: true,
            mutex: true
        });
        art.on("error", () => showError("视频播放失败，请刷新重试"));
    }

    document.addEventListener("DOMContentLoaded", pickFastest);
</script>
</body>
</html>

