<!DOCTYPE html>
<html>
<head>
<title>最快视频流播放器 - ArtPlayer Iframe 模式 (CDNJS)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link href="https://cdnjs.cloudflare.com/ajax/libs/artplayer/5.0.0/style.min.css" rel="stylesheet">

<style>
    /* 1. 全屏自适应样式 */
    html, body {
        margin: 0;
        padding: 0;
        height: 100%; 
        overflow: hidden;
        background-color: #000;
    }

    #video-container {
        width: 100%;
        height: 100vh;
        position: relative;
    }
    
    .temp-iframe {
        width: 100%;
        height: 100%;
        border: none;
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0; 
        pointer-events: none;
        transition: opacity 0.5s;
    }
    
    .art-player-wrapper {
        width: 100%;
        height: 100%;
    }
    
    /* 加载提示样式 */
    #loading-tip {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 18px;
        z-index: 10;
    }
</style>
</head>
<body>
<div id="video-container">
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/artplayer/5.0.0/artplayer.min.js"></script>

<script>
var apiArray = [
    // 您的解析 API 列表
    "https://www.ckplayer.vip/jiexi/?url=",
    "https://jx.m3u8.tv/jiexi/?url=",
    "https://jx.xmflv.com/?url=" 
];
// 从 URL 中获取原始视频地址
var origin = decodeURIComponent(document.location.href.split("url=")[1] || '');

var videoContainer = document.getElementById("video-container");
var fastestTime = Infinity;
var artPlayerInstance = null; // 用于存储 ArtPlayer 实例

// 检查 URL 参数是否缺失
if (!origin) {
    videoContainer.innerHTML = '<div style="color:white;text-align:center;padding:20px;">错误：URL 参数缺失！请在 URL 后添加 ?url=[您的视频地址]</div>';
    throw new Error('URL parameter is missing.');
}


function initArtPlayerIframeMode(iframe) {
    // ⚠️ 检查 ArtPlayer 是否已定义。如果此错误仍出现，请执行下一步本地下载。
    if (typeof ArtPlayer === 'undefined') {
        console.error('ArtPlayer 未定义！请检查 CDN 资源是否加载失败。');
        return; 
    }
    if (artPlayerInstance) return; 

    iframe.style.opacity = 0;
    iframe.style.pointerEvents = 'none';

    videoContainer.innerHTML = ''; 

    const artWrapper = document.createElement('div');
    artWrapper.id = 'art-player-wrapper';
    artWrapper.className = 'art-player-wrapper';
    videoContainer.appendChild(artWrapper);

    // 实例化 ArtPlayer Iframe 模式
    artPlayerInstance = new ArtPlayer({
        container: '#art-player-wrapper',
        url: iframe.src, 
        type: 'iframe', 
        title: '最快解析视频流',
        autoplay: true,
        muted: false,
        fullscreen: true,
        pip: true,
        autoSize: true, 
        loop: false,
        lang: 'zh-cn'
    });
    
    console.log(`ArtPlayer (Iframe Mode) 已加载源: ${iframe.src}`);
}

function createIframe(src) {
    var iframe = document.createElement("iframe");
    iframe.className = "temp-iframe";
    iframe.sandbox = "allow-scripts allow-same-origin allow-forms allow-popups allow-pointer-lock";
    iframe.frameBorder = "0";
    iframe.allowFullscreen = true;
    iframe.referrerPolicy = "no-referrer";
    iframe.src = src;
    
    iframe.loadStartTime = performance.now();
    
    iframe.onload = function() {
        var currentTime = performance.now();
        var loadTime = currentTime - this.loadStartTime;
        
        if (loadTime < fastestTime && !artPlayerInstance) {
            fastestTime = loadTime;
            initArtPlayerIframeMode(this);
        }
    };
    
    return iframe;
}

function loadVideos() {
    videoContainer.innerHTML = '<div id="loading-tip">正在竞速解析，请稍候...</div>';
    
    apiArray.forEach(function(api) {
        var iframe = createIframe(api + origin);
        videoContainer.appendChild(iframe);
    });
}

document.addEventListener("DOMContentLoaded", loadVideos);
</script>
</body>
</html>
